<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mirai 音乐播放器（探索版）</title>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    html, body {
      height: 100%;
      overflow: hidden;
    }
    body {
      /* 默认：小屏模式（小于 1440px），渐变方向跟随缩放 */
      background: linear-gradient(to bottom right, #E495F0, #546DAD);
      background-size: cover;
      background-position: left top;
    }
    
    /* 大屏模式：固定渐变宽度为居中的 1440px */
    @media (min-width: 1440px) {
      body {
        background: linear-gradient(
          to bottom right,
          #E495F0 calc(50% - 656px),
          #546DAD calc(50% + 656px)
        );
      }
    }
    
    .player_container {
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      color: white;
      font-family: PingFang SC;
    }
    .player_wrapper {
      width: clamp(330px, 100%, 1312px);
      padding: 2rem 0;             /* 固定内边距 */
      max-height: 100vh; /* 100vh 减去上下 padding */
      border-radius: 0;
      flex: 1;
      display: flex;
      flex-direction: column;
    }
    .info {
      flex: 1;
      min-height: 0;
      display: flex;
      flex-direction: row;
      padding: 3rem;
      position: relative;
      /* 为播放列表卡片提供定位上下文 */
    }
    .aside {
      flex-basis: 40%;
      max-width: 40%;
      display: flex;
      justify-content: flex-start;
      align-items: center;
    }
    .cover {
      display: flex;
      width: clamp(320px, calc(20vw + 2rem), 480px);
      aspect-ratio: 1 / 1;
      border-radius: 1rem;
    }
    .cover img {
      object-fit: scale-down;
      border-radius: inherit;
    }
    .core {
      flex-basis: 60%;
      max-width: 60%;
      display: flex;
      flex-direction: column;
      gap: 3rem;
    }
    .meta {
      display: flex;
      flex-direction: column;
      gap: 1rem;
      flex: 0 0 auto;
    }
    .title {
      font-size: 32px;
      font-weight: 600;
    }
    .artists {
      font-size: 20px;
      font-weight: 600;
    }
    .lyrics {
      display: flex;
      flex-direction: column;
      min-height: 0;
      flex: 1 1 auto;
    }
    .lyrics_viewport {
      flex: 1;      /* 占满父元素剩余空间 */
      overflow-y: auto;    /* 启用垂直滚动 */
      position: relative;
    }
    .lyrics_viewport::-webkit-scrollbar {
      display: none;              /* Chrome / Safari */
    }
    .lyrics_container {
      display: flex;
      flex-direction: column;
      gap: 2.5rem;
    }
    .lyric_line {
      font-size: 32px;
      text-box-trim: trim-both; /* 去掉上/下空白 */
      text-box-edge: cap alphabetic;
      margin: 0;
      display: inline-flex;
      align-items: center;
      line-height: 1.25;
      opacity: 0.3;
      font-weight: 500;
      position: relative;
    }
    /* 恢复播放高亮的原有样式 */
    .highlight {
      font-size: 40px;
      opacity: 1;
      color: #A5EDFF;
      font-weight: bolder;
    }
    .highlight ~ .lyric_line {
      opacity: 0.5;
    }
    
    
    
    /* 歌词时间提示样式 */
    .lyric_time_tip {
      position: absolute;
      right: -80px;
      top: 50%;
      transform: translateY(-50%);
      background: rgba(0, 0, 0, 0.8);
      color: white;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 12px;
      font-weight: 500;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.2s ease;
    }
    
    /* 歌词行悬停时显示时间提示 */
    .lyric_line:hover .lyric_time_tip {
      opacity: 1;
    }
    
    /* 移动端歌词行触摸时的样式 */
    @media (max-width: 1024px) {
      .lyric_line:active {
        background: rgba(255, 255, 255, 0.1);
        border-radius: 8px;
        cursor: pointer;
      }
    }
    
    /* PC端歌词行悬停样式 */
    @media (min-width: 1025px) {
      .lyric_line {
        cursor: pointer;
        padding-right: 90px; /* 为时间提示预留空间 */
      }
      
      .lyric_line:hover {
        opacity: 1;
        background: rgba(255, 255, 255, 0.2); /* 悬停时半透明矩形 */
      }
    }
    
    /* 播放列表卡片样式 - 基于.info元素定位 */
    .playlist_card {
      position: absolute;
      top: 2rem;
      left: 0;
      width: clamp(320px, calc(40% - 2rem), 480px);
      height: calc(100% - 4rem);
      background: rgba(29, 30, 34, 0.5);
      backdrop-filter: blur(12px);
      border-radius: 16px;
      padding: 0;
      z-index: 1000;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
      transition: all 0.3s ease;
      color: white;
      font-family: PingFang SC;
      /* 确保始终显示在aside上方 */
      pointer-events: auto;
    }
    
    /* 中等屏幕响应式 - 与aside保持一致 */
    @media (max-width: 1440px) {
      .playlist_card {
        width: clamp(288px, calc(40% - 1rem), 480px);
        top: 2rem;
        left: 0;
      }
    }
    
    /* 小屏幕响应式 - 从底部弹出 */
    @media (max-width: 1024px) {
      .playlist_card {
        /* 小屏幕上从底部弹出 */
        left: 50%;
        transform: translateX(-50%);
        bottom: 0;
        top: auto;
        width: calc(100% - 4rem);
        max-width: none;
        max-height: 75vh;
        border-radius: 16px 16px 0 0;
        box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.3);
      }
      
      /* 小屏幕上info元素不再作为定位上下文 */
      .info {
        position: static;
      }
    }
    
    /* 平板屏幕响应式 - 保持从底部弹出 */
    @media (max-width: 768px) {
      .playlist_card {
        /* 保持从底部弹出，宽度自适应 */
        width: 100%;
        max-width: none;
        max-height: 75vh;
      }
    }
    
    /* 手机屏幕响应式 - 保持从底部弹出 */
    @media (max-width: 480px) {
      .playlist_card {
        
      }
    }
    
    /* 播放列表头部样式 */
    .playlist_header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 2rem 3rem;
      background: rgba(0, 0, 0, 0.2);
      border-radius: 12px 12px 0 0;
      margin-bottom: 0;
      border-bottom: none;
    }
    
    .playlist_header h3 {
      margin: 0;
      font-size: 28px;
      font-weight: 600;
      color: white;
    }

    @media (max-width: 1024px) {
      .playlist_header {
        padding: 1.5rem 2rem;
      }

      .playlist_header h3 {
        font-size: 24px;
      }
    }
    
    /* 播放列表数量显示 */
    .playlist_count {
      font-size: 16px;
      color: rgba(255, 255, 255, 0.7);
    }
    
    /* 关闭按钮样式 */
    .close_playlist {
      display: none; /* 根据设计图隐藏关闭按钮 */
    }
    
    /* 播放列表内容样式 */
    .playlist_content {
      max-height: 80%;
      overflow-y: auto;
      padding: 0;
    }
    
    /* 当前播放歌曲样式 */
    .current_playing {
      background: linear-gradient(135deg, rgba(165, 237, 255, 0.2), rgba(165, 237, 255, 0.1));
      border-radius: 0;
      position: relative;
      overflow: hidden;
      padding: 0.75rem 1rem;
      margin-bottom: 0;
    }
    
    .current_playing::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(90deg, rgba(165, 237, 255, 0.3), transparent);
      opacity: 0.5;
      pointer-events: none;
    }
    
    /* 播放列表项样式 */
    .playlist_item {
      display: flex;
      align-items: center;
      padding: 1.5rem 3rem;
      border-radius: 0;
      cursor: pointer;
      transition: all 0.2s ease;
      margin-bottom: 0;
      background: transparent;
      position: relative;
    }
    
    .playlist_item:hover {
      background: rgba(255, 255, 255, 0.1);
    }
    
    .playlist_item.active {
      background: rgba(165, 237, 255, 0.2);
    }
    
    /* 播放列表项封面样式 */
    .playlist_item_cover {
      width: 80px;
      height: 80px;
      border-radius: 8px;
      margin-right: 1rem;
      overflow: hidden;
      flex-shrink: 0;
    }
    
    .playlist_item_cover img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    
    /* 播放列表项信息样式 */
    .playlist_item_info {
      flex: 1;
      min-width: 0;
    }
    
    .playlist_item_title {
      font-size: 24px;
      font-weight: 500;
      color: white;
      margin: 0 0 0.25rem 0;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    
    .playlist_item_artist {
      font-size: 18px;
      color: rgba(255, 255, 255, 0.6);
      margin: 0;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    
    /* 播放列表项音量图标 */
    .playlist_item_volume {
      margin-left: auto;
      opacity: 0.6;
      flex-shrink: 0;
    }
    
    /* 播放列表项时长 */
    .playlist_item_duration {
      font-size: 16px;
      color: rgba(255, 255, 255, 0.5);
      margin-left: 0.5rem;
      flex-shrink: 0;
    }

    @media (max-width: 1440px) {
      .playlist_item {
        padding: 1rem 3rem;
      }

      .playlist_item_cover {
        width: clamp(64px, calc(100vw / 16), 80px);
        height: clamp(64px, calc(100vw / 16), 80px);
      }

      .playlist_item_title {
        font-size: 22px;
      }

      .playlist_item_artist {
        font-size: 14px;
      }
    }

    @media (max-width: 1024px) {
      .playlist_item {
        padding: 1rem 2rem;
      }

      .playlist_item_cover {
        width: 64px;
        height: 64px;
      }

      .playlist_item_title {
        font-size: 20px;
      }

      .playlist_item_artist {
        font-size: 14px;
      }
    }

    @media (max-width: 480px) {
      .playlist_item {
        padding: 1rem 2rem;
      }

      .playlist_item_cover {
        width: 64px;
        height: 64px;
      }

      .playlist_item_title {
        font-size: 20px;
      }

      .playlist_item_artist {
        font-size: 14px;
      }
    }
    
    /* 滚动条样式 */
    .playlist_content::-webkit-scrollbar {
      width: 4px;
    }
    
    .playlist_content::-webkit-scrollbar-track {
      background: rgba(0, 0, 0, 0.2);
      border-radius: 2px;
    }
    
    .playlist_content::-webkit-scrollbar-thumb {
      background: rgba(165, 237, 255, 0.5);
      border-radius: 2px;
    }
    
    .playlist_content::-webkit-scrollbar-thumb:hover {
      background: rgba(165, 237, 255, 0.7);
    }
    
    .controls {
      height: 120px;
      flex-shrink: 0;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      
    }
    .progress_bar {
      overflow: visible; /* 必须 */ ;
      position: relative;
      z-index: 100;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    .track_unit {
      position: relative;
      height: 12px;
      background: rgba(255,255,255,0.2);
      border-radius: 6px;
      cursor: pointer;
      z-index: 50;       /* 顶层 */
      overflow: visible; /* 必须 */ ;
    }
    .progress_buffered {
      position: absolute;
      height: 100%;
      width: 0%;
      background: rgba(255,255,255,0.35);
      border-radius: 2px;
      pointer-events: none;
    }

    .progress_completed {
      position: absolute;
      height: 100%;
      width: 0%;
      background: #fff;
      border-radius: 6px;
      pointer-events: none;
    }

    .progress_handle {
      position: absolute;
      top: 50%;
      left: 0%;
      width: 24px;
      height: 24px;
      background: #fff;
      border-radius: 50%;
      transform: translate(-50%, -50%);
      pointer-events: auto;
      transition: opacity .2s, transform .2s;
      opacity: 1;
      z-index: 99;
    }
    
    /* 时间预览样式 */
    .time_preview {
      position: absolute;
      top: -36px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0, 0, 0, 0.8);
      color: white;
      padding: 6px 12px;
      border-radius: 4px;
      font-size: 14px;
      font-weight: 500;
      pointer-events: none;
      z-index: 100;
      white-space: nowrap;
      opacity: 0;
      transition: opacity 0.2s;
    }
    
    .time_preview::after {
      content: '';
      position: absolute;
      bottom: -4px;
      left: 50%;
      transform: translateX(-50%);
      width: 0;
      height: 0;
      border-left: 4px solid transparent;
      border-right: 4px solid transparent;
      border-top: 4px solid rgba(0, 0, 0, 0.8);
    }
    
    /* 拖动时显示时间预览 */
    .track_unit.dragging .time_preview {
      opacity: 1;
    }

    .time_unit {
      display: flex;
      width: 100%;
      justify-content: space-between;
      align-items: center;
    }

    .time_display {
      font-size: 1rem;
      letter-spacing: 0.05em;
      font-weight: 500;
    }

    .control_area {
      display: grid;
      grid-template-columns: 1fr auto 1fr; /* 左右均分，中间由内容决定 */
      align-items: center;
    }

    .control_area .center {
      display: flex;
      gap: 2rem;
    }

    .control_area .left,
    .control_area .right {
      display: flex;
      gap: 1rem;
    }

    .control_area .center {
      justify-content: center;
    }
    .control_area .left {
      justify-content: flex-start;
    }
    .control_area .right {
      justify-content: flex-end;
    }

    button {
      all: unset;           /* 完全重置（现代浏览器）*/
      cursor: pointer;      /* 恢复点击手势 */
      display: inline-flex; /* 让内部 SVG 更好居中 */
      align-items: center;
      justify-content: center;
    }


    .icon_button {
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #fff; /* svg 将用 currentColor */
    }
    
    .icon_button svg {
      width: 32px;
      height: 32px;
      fill: none;
      stroke: currentColor;
      stroke-width: 1.5;
    }

    .expand {
      display: flex;
      position: fixed;
      bottom: 14rem;
      align-items: flex-end;
      flex-direction: column;
      gap: 1rem;
      right: calc(50% - 656px);
    }
    

    /* 1440px 以下：缩小左右布局*/
    @media (max-width: 1440px) {
      .player_wrapper {
        padding: 2rem;
      }
      .info {
        gap: 1rem;
      }
      .aside .cover {
        width: clamp(288px, calc(25vw + 2rem) ,320px);
      }
      .lyric_line {
        font-size: 28px;
      }
      .highlight {
        font-size: 36px;
      }

      .icon_button {
        width: 28px;
        height: 28px;
      }
      
      .icon_button, .icon_button svg {
        width: 28px;
        height: 28px;
      }

      .button_control svg {
        width: 3rem;
        height: 3rem;
      }

      .play svg {
        width: 4rem;
        height: 4rem;
      }
    }
    
    
    /* 1024px 以下：切换为上下布局 */
    @media (max-width: 1024px) {
      .player_wrapper {
        padding: 2rem;
        gap: 1.5rem;
      }
      
      .info {
        flex-direction: column;
        align-items: center;
        padding: 0;
      }
      
      .aside {
        justify-content: center;
        width: 100%;
        flex-basis: 100%;
        max-width: 100%;
        padding: 2rem 0;
      }

      .aside .cover {
        width: 288px;
      }
      
      .core {
        width: 100%;
        min-height: 0;
        flex: 1;
        flex-basis: 100%;
        max-width: 100%;
        gap: 2rem;
      }

      .lyrics {
        order: 1;
      }

      .lyric_line {
        justify-content: center;
        text-align: center;
      }

      .meta {
        order: 2;
      }

      .lyrics_container {
        gap: 2rem;
      }

      .lyric_line {
        font-size: 24px;
      }

      .highlight {
        font-size: 32px;
      }
    }
    
    /* 768px 以下：手机平板模式 */
    @media (max-width: 768px) {
      .player_wrapper {
        padding: 2rem;
        gap: 1.5rem;
      }

      .aside .cover {
        width: clamp(256px, 40vw ,288px);
      }

      .core {
        gap: 3rem;
      }
      
      .lyric_line {
        font-size: 24px;
        line-height: 1.5;
      }

      .highlight {
        font-size: 28px;
        line-height: 1.5;
      }

      .title {
        font-size: clamp(24px, 5vw, 32px);
      }

      .artists, .time_display {
        font-size: clamp(16px, calc(5vw * 2/3), 20px);
      }

      .time_display {
        font-size: 1rem;
      }
    
      .control_area {
        gap: .5rem;
      }

      .control_area .center {
        gap: 1.5rem;
      }

      .track_unit {
        height: clamp(8px, calc(5vw * 1/3), 12px);
        border-radius: clamp(4px, calc(5vw * 1/6), 6px);
        
      }

      .progress_handle {
        width: clamp(16px, calc(10vw * 1/3), 24px);
        height: clamp(16px, calc(10vw * 1/3), 24px);
      }

      .icon_button, .icon_button svg {
        width: 24px;
        height: 24px;
      }

      .button_control svg {
        width: 2.5rem;
        height: 2.5rem;
      }

      .play svg {
        width: 4rem;
        height: 4rem;
      }
    }
    
    
    /* 480px 以下：小手机终端 */
    @media (max-width: 480px) {
      .player_wrapper {
        padding: 1.5rem;
        gap: 1rem;
      }

      .info {
        padding: 0;
        gap: 2rem;
      }

      .controls {
        height: 100%;
        gap: 0.5rem;
      }

      .expand {
        display: flex;
        position: fixed;
        bottom: 14rem;
        justify-content: space-between;
        width: calc(100% - 48px);
        flex-direction: row;
        right: unset;
        gap: 2rem;
      }

      .aside {
        padding-top: 2.5rem;
        padding-bottom: 0;
      }

      .aside .cover {
        width: clamp(196px, calc(50vw + 1rem) ,256px);
      }

      .core {
        gap: 4rem;
      }

      .meta {
        gap: 8px;
      }

      .title {
        font-size: 1.5rem;
      }

      .artists {
        font-size: 1rem;
      }

      .lyrics_container {
        gap: 1rem;
      }

      .lyric_line {
        font-size: 24px;
        line-height: 1.5;
      }

      .highlight {
        font-size: 28px;
        line-height: 1.5;
      }

      .track_unit {
        height: 8px;
        border-radius: 4px;
      }

      .progress_handle {
        height: 16px;
        width: 16px;
      }

      .time_display {
        font-size: 1rem;
      }

      .loop {
        display: none;
      }
      
      .control_area .center {
        gap: 1rem;
      }

      .icon_button, .icon_button svg {
        width: 24px;
        height: 24px;
      }

      .button_control svg {
        width: 2.5rem;
        height: 2.5rem;
      }

      .play svg {
        width: 4rem;
        height: 4rem;
      }
    }

  </style>
</head>

<body>
  <div class="player_container">
    <div class="player_wrapper">
      <section class="info">
        <!-- 播放列表卡片 -->
        <div class="playlist_card" id="playlistCard" style="display: none;">
          <div class="playlist_header">
            <h3>播放列表</h3>
            <div class="playlist_count">1 / 6</div>
          </div>
          <div class="playlist_content" id="playlistContent">
            <!-- 当前播放歌曲 -->
            <div class="playlist_item current_playing">
              <div class="playlist_item_cover">
                <img src="https://imgessl.kugou.com/stdmusic/20250417/20250417090950647300.jpg" alt="童言无忌">
              </div>
              <div class="playlist_item_info">
                <h4 class="playlist_item_title">童言无忌</h4>
                <p class="playlist_item_artist">HOYO-MiX</p>
              </div>
              <div class="playlist_item_volume">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24">
                  <path fill="white" d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"/>
                </svg>
              </div>
            </div>
            <!-- 播放列表数据将通过JavaScript动态生成 -->
          </div>
        </div>
        <div class="aside">
          <div class="cover">
            <img src="https://imgessl.kugou.com/stdmusic/20250417/20250417090950647300.jpg" width="100%" height="100%"></img>
          </div>
        </div>
        <div class="core">
          <div class="meta">
            <div class="title">童言无忌</div>
            <div class="artists">HOYO-MiX</div>
          </div>
          <div class="lyrics">
            <div class="lyrics_viewport">
              <div class="lyrics_container" id="lyricsContainer">
                <!-- 歌词将通过JavaScript动态生成 -->
              </div>
            </div>
          </div>
        </div>
      </section>
      <section class="controls">
        <div class="progress_bar">
          <div class="track_unit" role="slider">
            <div class="progress_buffered"></div>
            <div class="progress_completed"></div>
            <div class="progress_handle"></div>
            <!-- 时间预览元素 -->
            <div class="time_preview" id="timePreview">--:--</div>
          </div>
          <div class="time_unit">
            <div class="time_display current">--:--</div>
            <div class="time_display duration">--:--</div>
          </div>
        </div>
        <div class="control_area">
          <div class="left">
            <button class="icon_button loop">
              <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24">
              	<g fill="none" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5">
              		<path d="m16.388 3l1.003.976c.448.436.672.654.593.839C17.906 5 17.59 5 16.955 5h-7.76C5.22 5 2 8.134 2 12c0 1.487.477 2.866 1.29 4m4.322 5l-1.003-.976c-.448-.436-.672-.654-.593-.839C6.094 19 6.41 19 7.045 19h7.76C18.78 19 22 15.866 22 12a6.84 6.84 0 0 0-1.29-4" />
              		<path d="M13 15V9.316c0-.26-.282-.408-.48-.252l-1.52 1.2" />
              	</g>
              </svg>
            </button>
            <button class="icon_button playlist">
              <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 256 256">
              	<path fill="#fff" d="M32 64a8 8 0 0 1 8-8h176a8 8 0 0 1 0 16H40a8 8 0 0 1-8-8m8 72h120a8 8 0 0 0 0-16H40a8 8 0 0 0 0 16m72 48H40a8 8 0 0 0 0 16h72a8 8 0 0 0 0-16m135.66-57.7a8 8 0 0 1-10 5.36L208 122.75V192a32.05 32.05 0 1 1-16-27.69V112a8 8 0 0 1 10.3-7.66l40 12a8 8 0 0 1 5.36 9.96M192 192a16 16 0 1 0-16 16a16 16 0 0 0 16-16" />
              </svg>
            </button>
          </div>
          <div class="center">
            <button class="button_control prev">
              <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24">
              	<path fill="none" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.25" d="M6 7v10M17.028 5.267a.6.6 0 0 1 .972.471v12.524a.6.6 0 0 1-.972.47l-7.931-6.261a.6.6 0 0 1 0-.942z" />
              </svg>
            </button>
            <button class="button_control play">
              <svg class="play-icon" xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24">
              	<g fill="none">
              		<circle cx="12" cy="12" r="10" stroke="#fff" stroke-width="1" />
              		<path fill="#fff" d="M9.5 11.2v1.6c0 1.52 0 2.28.456 2.586s1.079-.032 2.326-.712l1.468-.8C15.25 13.056 16 12.647 16 12s-.75-1.056-2.25-1.874l-1.469-.8c-1.246-.68-1.87-1.02-2.325-.712C9.5 8.92 9.5 9.68 9.5 11.2" />
              	</g>
              </svg>
              <svg class="pause-icon" style="display: none;" xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24">
                <g fill="none" stroke="#fff" stroke-width="1">
                  <circle cx="12" cy="12" r="10" />
                  <path stroke-linecap="round" stroke-linejoin="round" d="M9.5 9v6m5-6v6" />
                </g>
              </svg>
            </button>
            <button class="button_control next">
              <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24">
              	<path fill="none" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.25" d="M18 7v10M6.972 5.267A.6.6 0 0 0 6 5.738v12.524a.6.6 0 0 0 .972.47l7.931-6.261a.6.6 0 0 0 0-.942z" />
              </svg>
            </button>
          </div>
          <div class="right">
            <button class="icon_button setting">
              <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24">
              	<g fill="none" stroke="#fff" stroke-width="1.5">
              		<path d="M3.082 13.945c-.529-.95-.793-1.426-.793-1.945s.264-.994.793-1.944L4.43 7.63l1.426-2.381c.559-.933.838-1.4 1.287-1.66c.45-.259.993-.267 2.08-.285L12 3.26l2.775.044c1.088.018 1.631.026 2.08.286s.73.726 1.288 1.659L19.57 7.63l1.35 2.426c.528.95.792 1.425.792 1.944s-.264.994-.793 1.944L19.57 16.37l-1.426 2.381c-.559.933-.838 1.4-1.287 1.66c-.45.259-.993.267-2.08.285L12 20.74l-2.775-.044c-1.088-.018-1.631-.026-2.08-.286s-.73-.726-1.288-1.659L4.43 16.37z" />
              		<circle cx="12" cy="12" r="3" />
              	</g>
              </svg>
            </button>
          </div>
        </div>
      </section>
      <section class="expand">
        <button class="icon_button setting">
              <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24">
              	<g fill="none" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5">
              		<path d="m16.388 3l1.003.976c.448.436.672.654.593.839C17.906 5 17.59 5 16.955 5h-7.76C5.22 5 2 8.134 2 12c0 1.487.477 2.866 1.29 4m4.322 5l-1.003-.976c-.448-.436-.672-.654-.593-.839C6.094 19 6.41 19 7.045 19h7.76C18.78 19 22 15.866 22 12a6.84 6.84 0 0 0-1.29-4" />
              		<path d="M13 15V9.316c0-.26-.282-.408-.48-.252l-1.52 1.2" />
              	</g>
              </svg>
            </button>
        <button class="icon_button setting">
              <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24">
              	<g fill="none" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5">
              		<path d="m16.388 3l1.003.976c.448.436.672.654.593.839C17.906 5 17.59 5 16.955 5h-7.76C5.22 5 2 8.134 2 12c0 1.487.477 2.866 1.29 4m4.322 5l-1.003-.976c-.448-.436-.672-.654-.593-.839C6.094 19 6.41 19 7.045 19h7.76C18.78 19 22 15.866 22 12a6.84 6.84 0 0 0-1.29-4" />
              		<path d="M13 15V9.316c0-.26-.282-.408-.48-.252l-1.52 1.2" />
              	</g>
              </svg>
            </button>
        <button class="icon_button setting">
              <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24">
              	<g fill="none" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5">
              		<path d="m16.388 3l1.003.976c.448.436.672.654.593.839C17.906 5 17.59 5 16.955 5h-7.76C5.22 5 2 8.134 2 12c0 1.487.477 2.866 1.29 4m4.322 5l-1.003-.976c-.448-.436-.672-.654-.593-.839C6.094 19 6.41 19 7.045 19h7.76C18.78 19 22 15.866 22 12a6.84 6.84 0 0 0-1.29-4" />
              		<path d="M13 15V9.316c0-.26-.282-.408-.48-.252l-1.52 1.2" />
              	</g>
              </svg>
            </button>
      </section>
    </div>
  </div>
  
  <!-- 音频元素 -->
  <audio id="audioPlayer" src="https://webfs.tx.kugou.com/202512140131/c439f42850acb814f81c38ffe324bbeb/v3/87cac94a7789830710812782c46c8d77/yp/full/ap1014_us0_mi8d30fb80663def66732ae55baae976f4_pi406_mx742378647_s1902822278.mp3" preload="metadata"></audio>
  
  <script>
    // 获取DOM元素
    const audioPlayer = document.getElementById('audioPlayer');
    const playBtn = document.querySelector('.button_control.play');
    const playIcon = playBtn.querySelector('.play-icon');
    const pauseIcon = playBtn.querySelector('.pause-icon');
    const prevBtn = document.querySelector('.button_control.prev');
    const nextBtn = document.querySelector('.button_control.next');
    const playlistBtn = document.querySelector('.icon_button.playlist');
    const progressBar = document.querySelector('.track_unit');
    const progressCompleted = document.querySelector('.progress_completed');
    const progressHandle = document.querySelector('.progress_handle');
    const timePreview = document.getElementById('timePreview');
    const currentTimeEl = document.querySelector('.time_display.current');
    const durationEl = document.querySelector('.time_display.duration');
    const lyricsContainer = document.getElementById('lyricsContainer');
    const lyricsViewport = document.querySelector('.lyrics_viewport');
    // 播放列表相关元素
    const playlistCard = document.getElementById('playlistCard');
    const closePlaylistBtn = document.getElementById('closePlaylist');
    const playlistContent = document.getElementById('playlistContent');
    const playlistCount = document.querySelector('.playlist_count');
    
    // 提前声明全局状态变量，避免访问前未初始化的错误
    let isDragging = false;
    
    
    // 歌词数据
    const lrcData = "[ti:\u7ae5\u8a00\u65e0忌 Children Know Nothing]\r\n[ar:HOYO-MiX]\r\n[al:\u5d29坏星穹铁道-\u884c于命途4 Experience the Paths Vol.4]\r\n[by:]\r\n[offset:0]\r\n[00:00.13]\u7ae5言无忌 Children Know Nothing - HOYO-MiX\r\n[00:03.88]\u4f5c曲 Composer：崔瀚普TSAR (HOYO-MiX)\r\n[00:07.78]\u7f16曲 Arranger：崔瀚普TSAR (HOYO-MiX)\r\n[00:12.18]\u6df7音师 Mixing Engineer：崔瀚普TSAR (HOYO-MiX)\r\n[00:17.43]\u6bcd带制作 Mastering Engineer：李敬浩Hao (HOYO-MiX)\r\n[00:23.45]出品 Produced by：HOYO-MiX\r\n";
    
    // 解析LRC歌词
    const parseLRC = (lrc) => {
      const lines = lrc.split('\n');
      const lyrics = [];
      
      // 匹配时间戳和歌词的正则
      const timeRegex = /\[(\d{2}):(\d{2})\.(\d{2})\]/g;
      
      lines.forEach(line => {
        // 跳过元数据行（以ti:, ar:, al:, by:, offset:开头的行）
        if (line.match(/^\[(ti|ar|al|by|offset):/i)) {
          return;
        }
        
        // 提取时间戳
        const times = [...line.matchAll(timeRegex)];
        if (times.length === 0) return;
        
        // 提取歌词内容
        const text = line.replace(timeRegex, '').trim();
        if (!text) return;
        
        // 转换时间戳为秒
        times.forEach(time => {
          const minutes = parseInt(time[1]);
          const seconds = parseInt(time[2]);
          const milliseconds = parseInt(time[3]);
          const totalSeconds = minutes * 60 + seconds + milliseconds / 100;
          
          lyrics.push({
            time: totalSeconds,
            text: text
          });
        });
      });
      
      // 按时间排序
      return lyrics.sort((a, b) => a.time - b.time);
    };
    
    // 格式化时间
    const formatTime = (seconds) => {
      const mins = Math.floor(seconds / 60);
      const secs = Math.floor(seconds % 60);
      return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
    };
    
    // 生成歌词DOM
    const renderLyrics = (lyrics) => {
      lyricsContainer.innerHTML = '';
      lyrics.forEach((lyric, index) => {
        const p = document.createElement('p');
        p.className = 'lyric_line';
        
        // 创建时间提示元素
        const timeTip = document.createElement('span');
        timeTip.className = 'lyric_time_tip';
        timeTip.textContent = formatTime(lyric.time);
        
        // 添加歌词文本和时间提示
        p.innerHTML = `${lyric.text}`;
        p.appendChild(timeTip);
        p.dataset.time = lyric.time;
        
        // 添加点击事件 - 跳转到对应时间
        p.addEventListener('click', () => {
          audioPlayer.currentTime = parseFloat(p.dataset.time);
        });
        
        lyricsContainer.appendChild(p);
      });
    };
    
    // 高亮当前歌词并滚动
    let currentIndex = -1;
    const highlightLyric = (time) => {
      const lyricLines = lyricsContainer.querySelectorAll('.lyric_line');
      let newIndex = -1;
      
      // 找到当前应该高亮的歌词
      for (let i = 0; i < lyricLines.length; i++) {
        const lyricTime = parseFloat(lyricLines[i].dataset.time);
        if (time >= lyricTime) {
          newIndex = i;
        } else {
          break;
        }
      }
      
      // 如果歌词行没有变化，不做处理
      if (newIndex === currentIndex) return;
      
      // 移除之前的高亮
      if (currentIndex >= 0 && currentIndex < lyricLines.length) {
        lyricLines[currentIndex].classList.remove('highlight');
      }
      
      // 添加新的高亮
      if (newIndex >= 0 && newIndex < lyricLines.length) {
        lyricLines[newIndex].classList.add('highlight');
        currentIndex = newIndex;
        
        // 滚动歌词，让高亮行居中
        const lineHeight = lyricLines[newIndex].offsetHeight;
        const viewportHeight = lyricsViewport.offsetHeight;
        const containerHeight = lyricsContainer.offsetHeight;
        const scrollTop = lyricsContainer.offsetTop + lyricLines[newIndex].offsetTop - (viewportHeight / 2) + (lineHeight / 2);
        
        // 平滑滚动
        lyricsViewport.scrollTo({
          top: scrollTop,
          behavior: 'smooth'
        });
      }
    };
    
    // 歌词同步控制变量 - 已在顶部声明
    // let isUserInteractingWithLyrics = false;
    // let lyricSyncTimer = null;
    // let lastInteractionTime = 0;
    
    // 重置歌词同步 - 清除锚定并重新同步到当前进度
    const resetLyricSync = () => {
      // 清除所有锚定状态
      const lyricLines = lyricsContainer.querySelectorAll('.lyric_line');
      lyricLines.forEach(line => {
        line.classList.remove('anchored');
      });
      
      // 清除定时器
      if (lyricSyncTimer) {
        clearTimeout(lyricSyncTimer);
        lyricSyncTimer = null;
      }
      
      // 立即同步到当前进度
      highlightLyric(audioPlayer.currentTime);
      isUserInteractingWithLyrics = false;
    };
    
    // 设置歌词锚定并启动同步定时器
    const setLyricAnchor = (line) => {
      // 清除所有之前的锚定
      const lyricLines = lyricsContainer.querySelectorAll('.lyric_line');
      lyricLines.forEach(l => {
        l.classList.remove('anchored');
      });
      
      // 添加当前锚定
      line.classList.add('anchored');
      
      // 更新交互状态
      isUserInteractingWithLyrics = true;
      lastInteractionTime = Date.now();
      
      // 清除之前的定时器
      if (lyricSyncTimer) {
        clearTimeout(lyricSyncTimer);
      }
      
      // 设置新的定时器 - 3秒后重新同步
      lyricSyncTimer = setTimeout(() => {
        resetLyricSync();
      }, 3000);
    };
    
    // 检测是否在视图中心的歌词行
    const getCenterLyricLine = () => {
      const lyricLines = lyricsContainer.querySelectorAll('.lyric_line');
      const viewportRect = lyricsViewport.getBoundingClientRect();
      const viewportCenterY = viewportRect.top + viewportRect.height / 2;
      
      let closestLine = null;
      let minDistance = Infinity;
      
      lyricLines.forEach(line => {
        const lineRect = line.getBoundingClientRect();
        const lineCenterY = lineRect.top + lineRect.height / 2;
        const distance = Math.abs(lineCenterY - viewportCenterY);
        
        if (distance < minDistance) {
          minDistance = distance;
          closestLine = line;
        }
      });
      
      return closestLine;
    };
    
    // 移除移动端触摸事件监听器，不再需要锚定逻辑
    // let startY = 0;
    // let isScrolling = false;
    
    // lyricsViewport.addEventListener('touchstart', (e) => {
    //   startY = e.touches[0].clientY;
    //   isScrolling = false;
    // });
    
    // lyricsViewport.addEventListener('touchmove', (e) => {
    //   isScrolling = true;
    //   // 清除之前的定时器
    //   if (lyricSyncTimer) {
    //     clearTimeout(lyricSyncTimer);
    //   }
    //   
    //   // 更新交互时间
    //   lastInteractionTime = Date.now();
    //   isUserInteractingWithLyrics = true;
    //   
    //   // 拖动进度条时不显示锚定行
    //   if (!isDragging) {
    //     // 获取视图中心的歌词行并锚定
    //     const centerLine = getCenterLyricLine();
    //     if (centerLine) {
    //       setLyricAnchor(centerLine);
    //     }
    //   }
    // });
    
    // lyricsViewport.addEventListener('touchend', () => {
    //   if (isScrolling) {
    //     // 滑动结束后重新设置定时器
    //     if (lyricSyncTimer) {
    //       clearTimeout(lyricSyncTimer);
    //     }
    //     
    //     lyricSyncTimer = setTimeout(() => {
    //       resetLyricSync();
    //     }, 3000);
    //   }
    // });
    
    // PC端鼠标悬停监听
    // 歌词行点击事件 - 点击锚定行时解除锚定
    // 歌词行点击事件 - 只保留跳转功能
    lyricsContainer.addEventListener('click', (e) => {
      const target = e.target.closest('.lyric_line');
      if (target && !isDragging) {
        // 跳转到对应时间
        audioPlayer.currentTime = parseFloat(target.dataset.time);
      }
    });
    
    // 移除鼠标悬停事件监听器，不再需要
    // lyricsContainer.removeEventListener('mouseover', mouseOverHandler);
    
    // 监听滚动事件，3秒无滚动后重新同步
    let lastScrollTime = 0;
    
    // 移除滚动事件监听器，不再需要锚定逻辑
    // lyricsViewport.addEventListener('scroll', () => {
    //   // 滚动相关逻辑已移除
    // });
    
    // 恢复默认timeupdate事件处理，移除锚定相关逻辑
    audioPlayer.addEventListener('timeupdate', () => {
      // 拖动期间暂停自动更新进度条UI，避免冲突
      if (!isDragging) {
        const progress = (audioPlayer.currentTime / audioPlayer.duration) * 100;
        progressCompleted.style.width = `${progress}%`;
        progressHandle.style.left = `${progress}%`;
      }
      
      // 始终更新时间显示
      currentTimeEl.textContent = formatTime(audioPlayer.currentTime);
      
      // 始终自动高亮当前歌词
      if (!isDragging) {
        highlightLyric(audioPlayer.currentTime);
      }
    });
    
    // 初始化歌词
    const lyrics = parseLRC(lrcData);
    renderLyrics(lyrics);
    
    // 模拟播放列表数据，包含歌词信息
    const playlistData = [
      {
        id: 1,
        title: "童言无忌",
        artist: "HOYO-MiX",
        cover: "https://imgessl.kugou.com/stdmusic/20250417/20250417090950647300.jpg",
        url: "https://webfs.tx.kugou.com/202512140131/c439f42850acb814f81c38ffe324bbeb/v3/87cac94a7789830710812782c46c8d77/yp/full/ap1014_us0_mi8d30fb80663def66732ae55baae976f4_pi406_mx742378647_s1902822278.mp3",
        duration: "02:02",
        active: true,
        lyrics: "[ti:童言无忌 Children Know Nothing]\r\n[ar:HOYO-MiX]\r\n[al:崩坏星穹铁道-行于命途4 Experience the Paths Vol.4]\r\n[by:]\r\n[offset:0]\r\n[00:00.13]童言无忌 Children Know Nothing - HOYO-MiX\r\n[00:03.88]作曲 Composer：崔瀚普TSAR (HOYO-MiX)\r\n[00:07.78]编曲 Arranger：崔瀚普TSAR (HOYO-MiX)\r\n[00:12.18]混音师 Mixing Engineer：崔瀚普TSAR (HOYO-MiX)\r\n[00:17.43]母带制作 Mastering Engineer：李敬浩Hao (HOYO-MiX)\r\n[00:23.45]出品 Produced by：HOYO-MiX\r\n"
      },
      {
        id: 2,
        title: "昔涟",
        artist: "张韶涵、HOYO-MiX",
        cover: "http://imge.kugou.com/stdmusic/20251105/20251105174543348446.jpg",
        url: "https://webfs.tx.kugou.com/202512140141/9be89e08bd43bc979315b3bddf859898/v3/02d3436caf1e96bee00ef53dc6d14269/yp/full/ap1014_us0_mi8d30fb80663def66732ae55baae976f4_pi406_mx808135317_s700033802.mp3",
        duration: "03:05",
        active: false,
        lyrics: "[id:$00000000]\r\n[ti:昔涟 (《崩坏：星穹铁道》昔涟动画短片中文单曲)]\r\n[ar:张韶涵\/HOYO-MiX]\r\n[al:崩坏星穹铁道-昔涟 Ripples of Past Reverie]\r\n[by:]\r\n[00:00.20]昔涟 (《崩坏：星穹铁道》昔涟动画短片中文单曲) - 张韶涵\/HOYO-MiX\r\n[00:04.27]作曲 Composer：崔瀚普TSAR (HOYO-MiX)\r\n[00:05.91]作词 Lyricist：烧鸡\/KBShinya\/陆棠疏\r\n[00:07.15]编曲 Arranger：崔瀚普TSAR (HOYO-MiX)\r\n[00:07.21]制作人 Producer：崔瀚普TSAR (HOYO-MiX)\/宫奇Gon (HOYO-MiX)\r\n[00:07.22]曾许下心愿 等待你 的出现\r\n[00:14.16]褪色的秋千 有本书 会纪念\r\n[00:21.29]我循着时间 捡起梦 的照片\r\n[00:28.37]童话还没有兑现 却需要说再见\r\n[00:37.33]如果有一天 岁月晕开书页\r\n[00:43.44]请把我 模糊的字迹当作 笑脸\r\n[00:50.68]很久前 想象 今天 画面\r\n[00:55.90]哭着 笑着 告别\r\n[00:58.47]陌生的情节 熟悉的侧脸 都重叠 oh~\r\n[01:04.86]出发前 无数 星光 缱绻\r\n[01:10.20]有回忆 落在 指尖\r\n[01:15.98]当世界向前 我会在原地 流连\r\n[01:51.20]当漪涟 一滴 一点 出现\r\n[01:56.33]轻轻 去向 天边\r\n[01:58.92]不管多遥远 都是追不上 的思念 oh~\r\n[02:05.40]会不会 可能 还能 相见\r\n[02:10.65]再回头只看一眼\r\n[02:19.56]当漪涟 消散 万千 不见\r\n[02:24.85]永恒和瞬间都 被爱意成全\r\n[02:28.88]我的明天叫做昨天 Hoo~\r\n[02:33.74]要相信 浪漫 一如 初见\r\n[02:39.04]请笑着 向我 道别\r\n[02:44.84]最后这一页 就让它无言\r\n[02:51.95]我会在扉页 等待你续写 起点\r\n[02:56.97]人声 Vocal Artist：张韶涵\r\n[02:57.68]制谱 Music Copyist：吴泽熙 Jersey Wu (HOYO-MiX)\r\n[02:58.05]和声 Backing Vocal：张韶涵\/奏Sou\r\n[02:58.35]配唱制作人 Vocal Producer：杨钧尧 Bryan Yang\r\n[02:58.74]音频编辑 Vocal Editing：杨钧尧 Bryan Yang\r\n[02:59.11]乐队 Orchestra：龙之艺交响乐团 Art of Loong Orchestra\r\n[02:59.56]贝斯 Bass：宣一亨Hento\r\n[02:59.80]架子鼓 Drums：眭逸凡Patrick\r\n[03:00.06]人声录音棚 Vocal Recording Studio：52Hz Studio\r\n[03:00.42]人声录音师 Vocal Recording Engineer：徐威 Aaron Xu\r\n[03:00.82]乐器录音棚 Instrumental Recording Studio：升赫录音棚Soundhub Studio\/上海音像公司录音棚 YX STUDIO\r\n[03:01.68]乐器录音师 Instrumental Recording Engineer：吴身宝\/李仁珏@Soundhub Studios\/莫家伟\r\n[03:02.30]混音师 Mixing Engineer：宫奇Gon (HOYO-MiX)\r\n[03:02.63]母带制作 Mastering Engineer：宫奇Gon (HOYO-MiX)\r\n[03:03.00]出品 Produced by：HOYO-MiX\r\n"
      },
      {
        id: 3,
        title: "LOVE 2000",
        artist: "遠野ひかる",
        cover: "http://imge.kugou.com/stdmusic/20250328/20250328182913377277.jpg",
        url: "https://webfs.kugou.com/202512140134/9566e1f975be74929c710ce1f31b7d2c/v3/31f776a095c8a596301166f4642e1769/yp/p_0_960167/ap1014_us66403282_mii0w1iw8z2ai2iphcu80ooo2ki81120_pi406_mx652173050_s4089705202.mp3",
        duration: "04:10",
        active: false,
        lyrics: "[ti:LOVE 2000]\r\n[ar:遠野ひかる]\r\n[al:LOVE 2000]\r\n[by:]\r\n[offset:0]\r\n[kana:1に(501,169)せ(670,53)ん(723,53)1とお1の1し1き(2094,60)ょ(2154,60)く(2214,96)1か(2310,128)ま(2438,88)1た1まさ1と1へん1き(3070,52)ょ(3122,52)く(3174,105)1むら1た1ゆう1い(3726,120)ち(3846,151)1あい1じ1ぶん1むね1と1きょう1み1み1か(56940,384)な(57324,184)1は(61108,288)な(61396,432)し(61828,544)1あ(62631,200)さ(62831,176)2きょう1かぜ1き1も1た(73869,312)の(74181,209)1き1が1き1あま1じ1ぶ(84888,276)ん(85164,134)1あ(85298,264)い(85562,232)1ひ(86387,185)と(86572,159)1あ(86947,232)い(87179,256)1ゆ(89853,344)め(90197,368)1ふく1だ(95453,353)れ(95806,439)1お(97525,352)も(97877,240)1む1し1て1ば(107057,360)な(107417,512)1ふう1せん1と1ころ1もど1い(119740,288)ま(120028,368)1み(120716,248)と(120964,184)1たい1せつ1こ(126391,200)と(126591,248)1み1す1み1い1ち(141342,160)か(141502,240)ら(141742,232)1こ(145076,192)と(145268,160)1あ(146276,336)い(146612,424)1じ1ぶん1むね1と1す(157419,400)こ(157819,464)1こ(161790,192)と(161982,424)1か1わ(164670,680)た(165350,472)し(165822,224)1ば(185531,256)な(185787,393)し(186180,669)1あ(188545,176)い(188721,200)1こと1い1み1うん1めい1つ(198034,360)よ(198394,320)1み1あ(202708,368)い(203076,400)1じ1ぶん1む(209821,655)ね(210476,688)1と1た1こ(218580,336)と(218916,624)1で1あ1いん1り(221804,276)ょ(222080,276)く(222356,216)1あ(225363,305)い(225668,351)1じ1ぶん1む(232371,704)ね(233075,728)1と1きょう1み1み1さ(251438,368)が(251806,176)]\r\n[00:00.23]LOVE 2000 - 遠野ひかる\r\n[00:01.55]词：ヒトミ\r\n[00:02.09]曲：鎌田雅人\r\n[00:02.95]编曲：村田祐一\r\n[00:22.03]愛は\r\n[00:23.53]どこからやってくるのでしょう\r\n[00:27.42]自分の胸に問いかけた\r\n[00:33.35]ニセモノなんか興味はないの\r\n[00:38.97]ホントだけを見つめたい\r\n[00:56.94]悲しいnewsと どうでもいい話\r\n[01:02.63]朝からもうそんなのうんざりで\r\n[01:08.30]今日はいつもよりも\r\n[01:11.07]風が気持ちイイからネ\r\n[01:13.86]楽しさに着替えてネ\r\n[01:18.57]気づけなかった\r\n[01:21.26]きっと甘えてたのかな\r\n[01:24.10]だから自分愛して\r\n[01:26.38]人を愛してみたいの\r\n[01:29.85]夢はいつでも膨らむばかりで\r\n[01:35.45]誰かの思いを無視してた\r\n[01:41.08]きっといつかはわかってるのかナ\r\n[01:46.66]手放した風船飛んでった\r\n[01:53.46]サバよんでみたって\r\n[01:56.23]あの頃に戻れやしないし\r\n[01:59.10]だから今を認めていたいの\r\n[02:04.73]とても大切な事も\r\n[02:07.52]見過ごしちゃったとしても\r\n[02:10.42]また見つければイイ\r\n[02:14.93]いつも言ってたネ\r\n[02:17.68]“まァ どうにかなるって”\r\n[02:20.54]だけど力まかせじゃ\r\n[02:22.89]どうにもならない事もアル\r\n[02:26.27]愛は\r\n[02:27.65]どこからやってくるのでしょう\r\n[02:31.82]自分の胸に問いかけた\r\n[02:37.41]少しずつだけどいろんな事が\r\n[02:43.03]変わって 私はここにアル\r\n[03:01.19]こんなハズじゃなかった\r\n[03:04.06]とんだオトギ話\r\n[03:06.84]なぞなぞみたいな愛す事の意味は\r\n[03:12.56]運命だけじゃなくて\r\n[03:15.31]センチメンタルでもなくて\r\n[03:18.03]強く見えないモノかナ\r\n[03:22.70]愛は\r\n[03:24.19]どこからやってくるのでしょう\r\n[03:28.24]自分の胸に問いかけた\r\n[03:33.91]食べてみなくちゃわからない事\r\n[03:39.54]出会いの引力はどれほどか\r\n[03:45.36]愛は\r\n[03:46.70]どこからやってくるのでしょう\r\n[03:50.73]自分の胸に問いかけた\r\n[03:56.61]ニセモノなんか興味はないワ\r\n[04:02.23]ホンモノだけ見つけたい\r\n[04:07.88]あなたをずっと探してた\r\n"
      }
    ];
    
    // 渲染播放列表
    const renderPlaylist = () => {
      // 清空所有播放列表内容，去除占位数据
      playlistContent.innerHTML = '';
      
      playlistData.forEach(item => {
        const playlistItem = document.createElement('div');
        playlistItem.className = `playlist_item ${item.active ? 'active' : ''}`;
        playlistItem.dataset.id = item.id;
        
        // 播放列表项内容
        playlistItem.innerHTML = `
          <div class="playlist_item_cover">
            <img src="${item.cover}" alt="${item.title}">
          </div>
          <div class="playlist_item_info">
            <h4 class="playlist_item_title">${item.title}</h4>
            <p class="playlist_item_artist">${item.artist}</p>
          </div>
          <div class="playlist_item_duration">${item.duration || '02:02'}</div>
        `;
        
        // 添加点击事件
        playlistItem.addEventListener('click', () => {
          // 切换到选中的歌曲
          playSong(item);
        });
        
        playlistContent.appendChild(playlistItem);
      });
    };
    
    // 播放选中的歌曲
    const playSong = (song) => {
      // 更新播放列表激活状态
      playlistData.forEach(item => {
        item.active = item.id === song.id;
      });
      
      // 更新播放列表显示
      renderPlaylist();
      
      // 更新播放器
      audioPlayer.src = song.url;
      audioPlayer.play();
      
      // 更新歌曲信息
      document.querySelector('.title').textContent = song.title;
      document.querySelector('.artists').textContent = song.artist;
      document.querySelector('.cover img').src = song.cover;
      
      // 加载并渲染新歌词
      if (song.lyrics) {
        const newLyrics = parseLRC(song.lyrics);
        renderLyrics(newLyrics);
      }
      
      // 更新播放列表计数
      if (playlistCount) {
        const currentIndex = playlistData.findIndex(item => item.active) + 1;
        const totalCount = playlistData.length;
        playlistCount.textContent = `${currentIndex} / ${totalCount}`;
      }
    };
    
    // 初始化播放列表
    renderPlaylist();
    
    // 初始化播放列表计数
    if (playlistCount) {
      const currentIndex = playlistData.findIndex(item => item.active) + 1;
      const totalCount = playlistData.length;
      playlistCount.textContent = `${currentIndex} / ${totalCount}`;
    }
    
    // 播放列表显示/隐藏逻辑
    playlistBtn.addEventListener('click', () => {
      if (playlistCard.style.display === 'block') {
        playlistCard.style.display = 'none';
      } else {
        playlistCard.style.display = 'block';
      }
    });
    
    // 关闭播放列表
    if (closePlaylistBtn) {
      closePlaylistBtn.addEventListener('click', () => {
        playlistCard.style.display = 'none';
      });
    }
    
    // 点击播放列表外部关闭
    document.addEventListener('click', (e) => {
      if (!playlistCard.contains(e.target) && !playlistBtn.contains(e.target)) {
        playlistCard.style.display = 'none';
      }
    });
    
    // 播放/暂停功能
    playBtn.addEventListener('click', () => {
      if (audioPlayer.paused) {
        audioPlayer.play();
      } else {
        audioPlayer.pause();
      }
    });
    
    // 监听音频播放状态变化，更新UI（处理外部控制，如键盘快捷键、系统媒体控制等）
    audioPlayer.addEventListener('play', () => {
      playIcon.style.display = 'none';
      pauseIcon.style.display = 'block';
    });
    
    audioPlayer.addEventListener('pause', () => {
      playIcon.style.display = 'block';
      pauseIcon.style.display = 'none';
    });

    // 加载元数据时更新总时长
    audioPlayer.addEventListener('loadedmetadata', () => {
      durationEl.textContent = formatTime(audioPlayer.duration);
    });
    
    // 实时更新进度条、时间和歌词
    audioPlayer.addEventListener('timeupdate', () => {
      // 拖动期间暂停自动更新进度条UI，避免冲突
      if (!isDragging) {
        const progress = (audioPlayer.currentTime / audioPlayer.duration) * 100;
        progressCompleted.style.width = `${progress}%`;
        progressHandle.style.left = `${progress}%`;
      }
      
      // 始终更新时间显示
      currentTimeEl.textContent = formatTime(audioPlayer.currentTime);
      
      // 拖动期间歌词由预览控制，不更新
      if (!isDragging) {
        highlightLyric(audioPlayer.currentTime);
      }
    });
    
    // 进度条拖动功能 - isDragging已在顶部声明
    // let isDragging = false;
    let originalTime = 0;
    
    const updateProgressUI = (progress) => {
      progressCompleted.style.width = `${progress}%`;
      progressHandle.style.left = `${progress}%`;
      timePreview.style.left = `${progress}%`;
      
      // 计算并显示预览时间
      if (audioPlayer.duration) {
        const previewTime = (progress / 100) * audioPlayer.duration;
        timePreview.textContent = formatTime(previewTime);
        
        // 预览歌词变化，但不改变实际音频时间
        highlightLyric(previewTime);
      }
    };
    
    const updateProgress = (e) => {
      if (!isDragging) return;
      
      const rect = progressBar.getBoundingClientRect();
      const offsetX = e.clientX - rect.left;
      const progress = Math.max(0, Math.min(100, (offsetX / rect.width) * 100));
      
      // 只更新UI，不改变音频时间
      updateProgressUI(progress);
    };
    
    // 获取鼠标或触摸事件的坐标
    const getEventOffsetX = (e) => {
      if (e.touches && e.touches.length > 0) {
        // 触摸开始或移动事件
        return e.touches[0].clientX;
      } else if (e.changedTouches && e.changedTouches.length > 0) {
        // 触摸结束事件
        return e.changedTouches[0].clientX;
      } else {
        // 鼠标事件
        return e.clientX;
      }
    };
    
    // 通用更新进度函数
    const handleProgressUpdate = (e) => {
      if (!isDragging) return;
      
      const rect = progressBar.getBoundingClientRect();
      const offsetX = getEventOffsetX(e) - rect.left;
      const progress = Math.max(0, Math.min(100, (offsetX / rect.width) * 100));
      
      // 只更新UI，不改变音频时间
      updateProgressUI(progress);
    };
    
    // 拖动开始
    const handleDragStart = (e) => {
      isDragging = true;
      originalTime = audioPlayer.currentTime;
      // 添加拖动类，显示时间预览
      progressBar.classList.add('dragging');
      handleProgressUpdate(e);
      
      // 阻止默认行为，防止页面滚动
      e.preventDefault();
    };
    
    // 拖动结束
    const handleDragEnd = (e) => {
      if (isDragging) {
        isDragging = false;
        // 移除拖动类，隐藏时间预览
        progressBar.classList.remove('dragging');
        
        // 拖动结束，同步进度到音频
        const rect = progressBar.getBoundingClientRect();
        const offsetX = getEventOffsetX(e) - rect.left;
        const progress = Math.max(0, Math.min(100, (offsetX / rect.width) * 100));
        audioPlayer.currentTime = (progress / 100) * audioPlayer.duration;
      }
    };
    
    // 点击进度条跳转
    const handleProgressClick = (e) => {
      // 拖动结束后不要重复处理，避免冲突
      if (isDragging) return;
      
      const rect = progressBar.getBoundingClientRect();
      const offsetX = getEventOffsetX(e) - rect.left;
      const progress = Math.max(0, Math.min(100, (offsetX / rect.width) * 100));
      audioPlayer.currentTime = (progress / 100) * audioPlayer.duration;
    };
    
    // 鼠标事件支持
    progressBar.addEventListener('mousedown', handleDragStart);
    document.addEventListener('mousemove', handleProgressUpdate);
    document.addEventListener('mouseup', handleDragEnd);
    progressBar.addEventListener('click', handleProgressClick);
    
    // 为触摸设备添加点击支持（快速点击，非拖动）
    let touchStartTime = 0;
    let touchStartX = 0;
    
    // 触摸事件支持（移动端）
    progressBar.addEventListener('touchstart', (e) => {
      // 记录触摸开始时间和位置，用于判断点击
      touchStartTime = Date.now();
      touchStartX = getEventOffsetX(e);
      
      // 处理拖动开始
      handleDragStart(e);
    }, { passive: false });
    
    document.addEventListener('touchmove', handleProgressUpdate, { passive: false });
    
    progressBar.addEventListener('touchend', (e) => {
      // 获取触摸结束位置
      const touchEndX = getEventOffsetX(e);
      const touchDuration = Date.now() - touchStartTime;
      const touchDistance = Math.abs(touchEndX - touchStartX);
      
      // 处理拖动结束
      handleDragEnd(e);
      
      // 判断是否为点击事件（短时间、短距离）
      if (touchDuration < 300 && touchDistance < 10) {
        handleProgressClick(e);
      }
    });
    
    // 上一曲功能
    prevBtn.addEventListener('click', () => {
      // 找到当前播放歌曲的索引
      const currentIndex = playlistData.findIndex(item => item.active);
      // 计算上一首索引，循环播放
      const prevIndex = currentIndex === 0 ? playlistData.length - 1 : currentIndex - 1;
      // 播放上一首
      playSong(playlistData[prevIndex]);
    });
    
    // 下一曲功能
    nextBtn.addEventListener('click', () => {
      // 找到当前播放歌曲的索引
      const currentIndex = playlistData.findIndex(item => item.active);
      // 计算下一首索引，循环播放
      const nextIndex = currentIndex === playlistData.length - 1 ? 0 : currentIndex + 1;
      // 播放下一首
      playSong(playlistData[nextIndex]);
    });
  </script>
</body>
</html>